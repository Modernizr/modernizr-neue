define(["require","exports"],function(require,exports){var Markdown;function identity(x){return x}function returnFalse(x){return!1}function HookCollection(){}function SaveHash(){}return Markdown="object"==typeof exports&&"function"==typeof require?exports:{},HookCollection.prototype={chain:function(hookname,func){var original=this[hookname];if(!original)throw new Error("unknown hook "+hookname);this[hookname]=original===identity?func:function(x){return func(original(x))}},set:function(hookname,func){if(!this[hookname])throw new Error("unknown hook "+hookname);this[hookname]=func},addNoop:function(hookname){this[hookname]=identity},addFalse:function(hookname){this[hookname]=returnFalse}},Markdown.HookCollection=HookCollection,SaveHash.prototype={set:function(key,value){this["s_"+key]=value},get:function(key){return this["s_"+key]}},Markdown.Converter=function(){var g_urls,g_titles,g_html_blocks,g_list_level,pluginHooks=this.hooks=new HookCollection;function _HashHTMLBlocks(text){return text=(text=(text=(text=(text=text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,hashElement)).replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,hashElement)).replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,hashElement)).replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,hashElement)).replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,hashElement)}function hashElement(wholeMatch,m1){var blockText=m1;return blockText=(blockText=blockText.replace(/^\n+/,"")).replace(/\n+$/g,""),blockText="\n\n~K"+(g_html_blocks.push(blockText)-1)+"K\n\n"}function _RunBlockGamut(text,doNotUnhash){return text=function(text,doNotUnhash){for(var grafs=(text=(text=text.replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),grafsOut=[],markerRe=/~K(\d+)K/,end=grafs.length,i=0;i<end;i++){var str=grafs[i];markerRe.test(str)?grafsOut.push(str):/\S/.test(str)&&(str=(str=_RunSpanGamut(str)).replace(/^([ \t]*)/g,"<p>"),str+="</p>",grafsOut.push(str))}if(!doNotUnhash){end=grafsOut.length;for(i=0;i<end;i++)for(var foundAny=!0;foundAny;)foundAny=!1,grafsOut[i]=grafsOut[i].replace(/~K(\d+)K/g,function(wholeMatch,id){return foundAny=!0,g_html_blocks[id]})}return grafsOut.join("\n\n")}(text=_HashHTMLBlocks(text=function(text){return text=text.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(wholeMatch,m1){var text,bq=m1;return bq=(bq=(bq=_RunBlockGamut(bq=(bq=(bq=bq.replace(/^[ \t]*>[ \t]?/gm,"~0")).replace(/~0/g,"")).replace(/^[ \t]+$/gm,""))).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(wholeMatch,m1){var pre=m1;return pre=(pre=pre.replace(/^  /gm,"~0")).replace(/~0/g,"")}),text=(text="<blockquote>\n"+bq+"\n</blockquote>").replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(g_html_blocks.push(text)-1)+"K\n\n"})}(text=function(text){return text=(text=(text+="~0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(wholeMatch,m1,m2){var codeblock=m1,nextChar=m2;return"\n\n"+(codeblock="<pre><code>"+(codeblock=(codeblock=(codeblock=_Detab(codeblock=_EncodeCode(_Outdent(codeblock)))).replace(/^\n+/g,"")).replace(/\n+$/g,""))+"\n</code></pre>")+"\n\n"+nextChar})).replace(/~0/,"")}(text=_DoLists(text=(text=(text=(text=function(text){return text=(text=(text=text.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(wholeMatch,m1){return"<h1>"+_RunSpanGamut(m1)+"</h1>\n\n"})).replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(matchFound,m1){return"<h2>"+_RunSpanGamut(m1)+"</h2>\n\n"})).replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(wholeMatch,m1,m2){var h_level=m1.length;return"<h"+h_level+">"+_RunSpanGamut(m2)+"</h"+h_level+">\n\n"})}(text)).replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,"<hr />\n")).replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,"<hr />\n")).replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,"<hr />\n"))))),doNotUnhash)}function _RunSpanGamut(text){return text=(text=function(text){return text=(text=text.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4")).replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}(text=_EncodeAmpsAndAngles(text=(text=function(text){text=text.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4");return text=text.replace(/<((https?|ftp):[^'">\s]+)>/gi,function(wholematch,m1){return'<a href="'+m1+'">'+pluginHooks.plainLinkText(m1)+"</a>"})}(text=function(text){return text=(text=(text=text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,writeAnchorTag)).replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,writeAnchorTag)).replace(/(\[([^\[\]]+)\])()()()()()/g,writeAnchorTag)}(text=function(text){return text=(text=text.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,writeImageTag)).replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,writeImageTag)}(text=function(text){return text=(text=text.replace(/\\(\\)/g,escapeCharacters_callback)).replace(/\\([`*_{}\[\]()>#+-.!])/g,escapeCharacters_callback)}(text=function(text){return text=text.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(wholeMatch){var tag=wholeMatch.replace(/(.)<\/?code>(?=.)/g,"$1`");return tag=escapeCharacters(tag,"!"==wholeMatch.charAt(1)?"\\`*_/":"\\`*_")})}(text=function(text){return text=text.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(wholeMatch,m1,m2,m3,m4){var c=m3;return m1+"<code>"+(c=(c=_EncodeCode(c=(c=c.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""))).replace(/:\/\//g,"~P"))+"</code>"})}(text))))))).replace(/~P/g,"://")))).replace(/  +\n/g," <br>\n")}function writeAnchorTag(wholeMatch,m1,m2,m3,m4,m5,m6,m7){null==m7&&(m7="");var whole_match=m1,link_text=m2.replace(/:\/\//g,"~P"),link_id=m3.toLowerCase(),url=m4,title=m7;if(""==url)if(""==link_id&&(link_id=link_text.toLowerCase().replace(/ ?\n/g," ")),url="#"+link_id,null!=g_urls.get(link_id))url=g_urls.get(link_id),null!=g_titles.get(link_id)&&(title=g_titles.get(link_id));else{if(!(-1<whole_match.search(/\(\s*\)$/m)))return whole_match;url=""}var result='<a href="'+(url=escapeCharacters(url=function(url){if(!url)return"";var len=url.length;return url.replace(_problemUrlChars,function(match,offset){return"~D"==match?"%24":":"!=match||offset!=len-1&&!/[0-9\/]/.test(url.charAt(offset+1))?"%"+match.charCodeAt(0).toString(16):":"})}(url),"*_"))+'"';return""!=title&&(result+=' title="'+(title=escapeCharacters(title=attributeEncode(title),"*_"))+'"'),result+=">"+link_text+"</a>"}function attributeEncode(text){return text.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function writeImageTag(wholeMatch,m1,m2,m3,m4,m5,m6,m7){var whole_match=m1,alt_text=m2,link_id=m3.toLowerCase(),url=m4,title=m7;if(title=title||"",""==url){if(""==link_id&&(link_id=alt_text.toLowerCase().replace(/ ?\n/g," ")),url="#"+link_id,null==g_urls.get(link_id))return whole_match;url=g_urls.get(link_id),null!=g_titles.get(link_id)&&(title=g_titles.get(link_id))}alt_text=escapeCharacters(attributeEncode(alt_text),"*_[]()");var result='<img src="'+(url=escapeCharacters(url,"*_"))+'" alt="'+alt_text+'"';return result+=' title="'+(title=escapeCharacters(title=attributeEncode(title),"*_"))+'"',result+=" />"}function _DoLists(text){text+="~0";var whole_list=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return text=(text=g_list_level?text.replace(whole_list,function(wholeMatch,m1,m2){var list=m1,list_type=-1<m2.search(/[*+-]/g)?"ul":"ol",result=_ProcessListItems(list,list_type);return result="<"+list_type+">"+(result=result.replace(/\s+$/,""))+"</"+list_type+">\n"}):(whole_list=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,text.replace(whole_list,function(wholeMatch,m1,m2,m3){var runup=m1,list=m2,list_type=-1<m3.search(/[*+-]/g)?"ul":"ol",result=_ProcessListItems(list,list_type);return result=runup+"<"+list_type+">\n"+result+"</"+list_type+">\n"}))).replace(/~0/,"")}pluginHooks.addNoop("plainLinkText"),pluginHooks.addNoop("preConversion"),pluginHooks.addNoop("postConversion"),this.makeHtml=function(text){if(g_urls)throw new Error("Recursive call to converter.makeHtml");return g_urls=new SaveHash,g_titles=new SaveHash,g_html_blocks=[],g_list_level=0,text=(text=(text=function(text){return text=text.replace(/~E(\d+)E/g,function(wholeMatch,m1){var charCodeToReplace=parseInt(m1);return String.fromCharCode(charCodeToReplace)})}(text=_RunBlockGamut(text=function(text){return text=text.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(wholeMatch,m1,m2,m3,m4,m5){return m1=m1.toLowerCase(),g_urls.set(m1,_EncodeAmpsAndAngles(m2)),m4?m3:(m5&&g_titles.set(m1,m5.replace(/"/g,"&quot;")),"")})}(text=_HashHTMLBlocks(text=(text=_Detab(text="\n\n"+(text=(text=(text=(text=(text=pluginHooks.preConversion(text)).replace(/~/g,"~T")).replace(/\$/g,"~D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n"))+"\n\n")).replace(/^[ \t]+$/gm,"")))))).replace(/~D/g,"$$")).replace(/~T/g,"~"),text=pluginHooks.postConversion(text),g_html_blocks=g_titles=g_urls=null,text};var _listItemMarkers={ol:"\\d+[.]",ul:"[*+-]"};function _ProcessListItems(list_str,list_type){g_list_level++,list_str=list_str.replace(/\n{2,}$/,"\n"),list_str+="~0";var marker=_listItemMarkers[list_type],re=new RegExp("(^[ \\t]*)("+marker+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+marker+")[ \\t]+))","gm"),last_item_had_a_double_newline=!1;return list_str=(list_str=list_str.replace(re,function(wholeMatch,m1,m2,m3){var item=m3,ends_with_double_newline=/\n\n$/.test(item);return item=ends_with_double_newline||-1<item.search(/\n{2,}/)||last_item_had_a_double_newline?_RunBlockGamut(_Outdent(item),!0):_RunSpanGamut(item=(item=_DoLists(_Outdent(item))).replace(/\n$/,"")),last_item_had_a_double_newline=ends_with_double_newline,"<li>"+item+"</li>\n"})).replace(/~0/g,""),g_list_level--,list_str}function _EncodeCode(text){return text=escapeCharacters(text=(text=(text=text.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),"*_{}[]\\",!1)}function _EncodeAmpsAndAngles(text){return text=(text=text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function _Outdent(text){return text=(text=text.replace(/^(\t|[ ]{1,4})/gm,"~0")).replace(/~0/g,"")}function _Detab(text){if(!/\t/.test(text))return text;var v,spaces=["    ","   ","  "," "],skew=0;return text.replace(/[\n\t]/g,function(match,offset){return"\n"===match?(skew=offset+1,match):(v=(offset-skew)%4,skew=offset+1,spaces[v])})}var _problemUrlChars=/(?:["'*()[\]:]|~D)/g;function escapeCharacters(text,charsToEscape,afterBackslash){var regexString="(["+charsToEscape.replace(/([\[\]\\])/g,"\\$1")+"])";afterBackslash&&(regexString="\\\\"+regexString);var regex=new RegExp(regexString,"g");return text=text.replace(regex,escapeCharacters_callback)}function escapeCharacters_callback(wholeMatch,m1){return"~E"+m1.charCodeAt(0)+"E"}},new Markdown.Converter});
//# sourceMappingURL=Markdown.Converter.js.map
